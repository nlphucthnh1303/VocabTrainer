@if (topic(); as t) {
  <div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h2 class="text-3xl font-bold text-slate-800 dark:text-slate-200 flex items-center gap-3">
              {{ t.name }}
              <span class="text-xs font-semibold px-2 py-1 rounded-full"
                  [class.bg-primary-100]="t.difficulty === 'Beginner'"
                  [class.text-primary-800]="t.difficulty === 'Beginner'"
                  [class.dark:bg-primary-900]="t.difficulty === 'Beginner'"
                  [class.dark:text-primary-200]="t.difficulty === 'Beginner'"
                  [class.bg-yellow-100]="t.difficulty === 'Intermediate'"
                  [class.text-yellow-800]="t.difficulty === 'Intermediate'"
                  [class.dark:bg-yellow-900]="t.difficulty === 'Intermediate'"
                  [class.dark:text-yellow-200]="t.difficulty === 'Intermediate'"
                  [class.bg-red-100]="t.difficulty === 'Advanced'"
                  [class.text-red-800]="t.difficulty === 'Advanced'"
                  [class.dark:bg-red-900]="t.difficulty === 'Advanced'"
                  [class.dark:text-red-200]="t.difficulty === 'Advanced'">
                  {{ t.difficulty }}
              </span>
            </h2>
            <p class="mt-1 text-slate-500 dark:text-slate-400">{{ t.description }}</p>
        </div>
        <div class="flex items-center gap-3">
          <button (click)="startPractice.emit()" class="px-4 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-colors">{{ translationService.translate('startPractice') }}</button>
          <button (click)="startFlashcards.emit()" class="px-4 py-2 bg-slate-600 text-white font-semibold rounded-lg shadow-md hover:bg-slate-700 transition-colors">{{ translationService.translate('flashcardMode') }}</button>
        </div>
    </div>
    
    <!-- Vocabulary List -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-slate-900 dark:text-white">{{ translationService.translate('vocabList') }} ({{ t.vocabularies.length }})</h3>
            <div class="flex gap-2">
                <button (click)="isImportModalOpen.set(true)" class="px-3 py-2 text-sm bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-semibold rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">{{ translationService.translate('importFromJson') }}</button>
                <button (click)="openVocabModal()" class="px-3 py-2 text-sm bg-primary-600 text-white font-semibold rounded-lg shadow-sm hover:bg-primary-700 transition-colors">{{ translationService.translate('addWord') }}</button>
            </div>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-slate-500 dark:text-slate-400">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50 dark:bg-slate-700 dark:text-slate-300">
                    <tr>
                        <th scope="col" class="px-6 py-3">{{ translationService.translate('word') }}</th>
                        <th scope="col" class="px-6 py-3">{{ translationService.translate('phonetic') }}</th>
                        <th scope="col" class="px-6 py-3">{{ translationService.translate('partOfSpeech') }}</th>
                        <th scope="col" class="px-6 py-3">{{ translationService.translate('meaning') }}</th>
                        <th scope="col" class="px-6 py-3"><span class="sr-only">{{ translationService.translate('actions') }}</span></th>
                    </tr>
                </thead>
                <tbody>
                    @for (item of paginatedVocabularies(); track item.id) {
                        <tr class="bg-white dark:bg-slate-800 border-b dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-600/50">
                            <th scope="row" class="px-6 py-4 font-medium text-slate-900 dark:text-white whitespace-nowrap">{{ item.word }}</th>
                            <td class="px-6 py-4">{{ item.phonetic }}</td>
                            <td class="px-6 py-4">{{ item.partOfSpeech }}</td>
                            <td class="px-6 py-4">{{ item.meaning }}</td>
                            <td class="px-6 py-4 text-right">
                                <button (click)="openVocabModal(item)" class="font-medium text-primary-600 dark:text-primary-400 hover:underline mr-3">{{ translationService.translate('edit') }}</button>
                                <button (click)="deleteItem(item.id)" class="font-medium text-red-600 dark:text-red-400 hover:underline">{{ translationService.translate('delete') }}</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @if(t.vocabularies.length === 0) {
              <p class="text-center py-8 text-slate-500 dark:text-slate-400">{{ translationService.translate('noWords') }}</p>
            }
        </div>

        <!-- Pagination Controls -->
        @if (totalPages() > 1) {
            <div class="flex items-center justify-between pt-4">
                <span class="text-sm text-slate-700 dark:text-slate-400">
                    {{ translationService.translate('page') }} <span class="font-semibold">{{ currentPage() }}</span> {{ translationService.translate('of') }} <span class="font-semibold">{{ totalPages() }}</span>
                </span>
                <div class="inline-flex mt-2 xs:mt-0">
                    <button (click)="goToPage(currentPage() - 1)" [disabled]="currentPage() === 1" class="px-4 py-2 text-sm font-medium text-white bg-slate-800 rounded-l hover:bg-slate-900 dark:bg-slate-600 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        {{ translationService.translate('prev') }}
                    </button>
                    <button (click)="goToPage(currentPage() + 1)" [disabled]="currentPage() === totalPages()" class="px-4 py-2 text-sm font-medium text-white bg-slate-800 border-0 border-l border-slate-700 rounded-r hover:bg-slate-900 dark:bg-slate-600 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        {{ translationService.translate('next') }}
                    </button>
                </div>
            </div>
        }

    </div>
  </div>

  <!-- Add/Edit Vocabulary Modal -->
  @if (isVocabModalOpen()) {
    <div class="fixed inset-0 bg-black/60 z-40 flex items-center justify-center animate-fade-in" (click)="closeVocabModal()">
      <div (click)="$event.stopPropagation()" class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg mx-4 animate-scale-in">
        <div class="flex items-center justify-between rounded-t dark:border-gray-600 border-gray-200 mb-5">
             <h3 class="text-xl font-bold mb-4">{{ editingItem() ? translationService.translate('editWordTitle') : translationService.translate('addWordTitle') }}</h3>
            <button type="button" (click)="closeVocabModal()" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
        </div>
        <form (ngSubmit)="saveItem()">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
            <div>
              <label for="vocab-word" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ translationService.translate('word') }}</label>
              <input id="vocab-word" type="text" [value]="word()" (input)="word.set($event.target.value)" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
            </div>
            <div>
              <label for="vocab-phonetic" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ translationService.translate('phonetic') }}</label>
              <input id="vocab-phonetic" type="text" [value]="phonetic()" required (input)="phonetic.set($event.target.value)" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
            </div>
          </div>
          <!-- <div class="mb-3">
            <label for="vocab-pos" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ translationService.translate('partOfSpeech') }}</label>
            <input id="vocab-pos" type="text" [value]="partOfSpeech()" required (input)="partOfSpeech.set($event.target.value)" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
          </div> -->
          <div class="mb-3">
              <label for="vocab-pos" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ translationService.translate('partOfSpeech') }}</label>
              <select id="vocab-pos" type="text" [value]="partOfSpeech()" required (input)="partOfSpeech.set($event.target.value)" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option value="Noun">{{ translationService.translate('partOfSpeech_Noun') }}</option>
                <option value="Verb">{{ translationService.translate('partOfSpeech_Verb') }}</option>
                <option value="Adjective">{{ translationService.translate('partOfSpeech_Adjective') }}</option>
                <option value="Adverb">{{ translationService.translate('partOfSpeech_Adverb') }}</option>
                <option value="Pronoun">{{ translationService.translate('partOfSpeech_Pronoun') }}</option>
                <option value="Preposition">{{ translationService.translate('partOfSpeech_Preposition') }}</option>
                <option value="Conjunction">{{ translationService.translate('partOfSpeech_Conjunction') }}</option>
                <option value="Gerund">{{ translationService.translate('partOfSpeech_Gerund') }}</option>
              </select>
            </div>



          <div class="mb-3">
            <label for="vocab-meaning" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ translationService.translate('meaning') }}</label>
            <textarea id="vocab-meaning" rows="5" cols="3" [value]="meaning()" (input)="meaning.set($event.target.value)" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"></textarea>
          </div>
          <div class="mt-6 flex justify-end gap-3">
            <button type="button" (click)="closeVocabModal()" class="px-4 py-2 bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors">{{ translationService.translate('cancel') }}</button>
            <button type="button" (click)="saveItem()" class="px-4 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-colors">{{ translationService.translate('saveWord') }}</button>
          </div>
        </form>
      </div>
    </div>
  }
  
  <!-- Import Modal -->
  @if (isImportModalOpen()) {
    <div class="fixed inset-0 bg-black/60 z-40 flex items-center justify-center animate-fade-in" (click)="isImportModalOpen.set(false)">
      <div (click)="$event.stopPropagation()" class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg mx-4 animate-scale-in">
        <h3 class="text-xl font-bold mb-4">{{ translationService.translate('importModalTitle') }}</h3>
        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">
          {{ translationService.translate('importModalDesc') }}
          <code class="font-mono text-xs bg-slate-100 dark:bg-slate-700 p-1 rounded">Word</code>, 
          <code class="font-mono text-xs bg-slate-100 dark:bg-slate-700 p-1 rounded">Phonetic</code>, 
          <code class="font-mono text-xs bg-slate-100 dark:bg-slate-700 p-1 rounded">Part of Speech</code>, and 
          <code class="font-mono text-xs bg-slate-100 dark:bg-slate-700 p-1 rounded">Meaning</code>.
        </p>
        <div class="mt-4">
            <!-- <label class="block w-full cursor-pointer bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 border-2 border-dashed border-slate-300 dark:border-slate-500 rounded-lg p-8 text-center">
                <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span class="mt-2 block text-sm font-semibold text-slate-900 dark:text-slate-100">{{ translationService.translate('importModalUpload') }}</span>
                <input type="file" (change)="handleFileImport($event)" accept=".xlsx" class="sr-only">
            </label> -->
            <textarea 
              id="json-input"
              [value]="jsonInput()" (input)="jsonInput.set($event.target.value)"
              rows="10" 
              placeholder='[{"Word": "accuracy", "Phonetic": "/ˈækjərəsi/", "Part of Speech": "n", "Meaning": "sự chính xác"}, ...]'
              class="mb-4 p-3 border border-indigo-300 rounded-lg w-full text-sm font-mono focus:ring-indigo-500 focus:border-indigo-500"
            ></textarea>
        </div>
        <div class="mt-6 flex justify-end">
            <button type="button" (click)="isImportModalOpen.set(false)" class="me-2 px-4 py-2 bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors">{{ translationService.translate('cancel') }}</button>
            <button type="button"  (click)="handleParse()" class="px-4 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-colors" >Nhập mã JSON</button>
        </div>
      </div>
    </div>
  }

} @else {
  <p class="text-center p-8">{{ translationService.translate('topicNotFound') }}</p>
}
