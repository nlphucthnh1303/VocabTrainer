@switch (quizState()) {
  @case ('generating') {
    <div class="text-center p-12 bg-white dark:bg-slate-800 rounded-xl shadow-lg animate-fade-in">
      <svg class="mx-auto h-12 w-12 text-primary-600 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <h2 class="mt-4 text-2xl font-bold text-slate-800 dark:text-slate-200">Generating Quiz...</h2>
      <p class="mt-2 text-slate-500 dark:text-slate-400">Please wait while we prepare your questions.</p>
    </div>
  }
  @case ('in_progress') {
    <div class="max-w-2xl mx-auto animate-fade-in">
      @if(currentQuestion(); as question) {
        <!-- Header -->
        <div class="mb-6">
            <h2 class="text-xl font-bold text-center text-slate-800 dark:text-slate-200">
              Practice: {{ topic().name }}
            </h2>
            <div class="mt-3 w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5">
                <div class="bg-primary-600 h-2.5 rounded-full transition-all duration-300" [style.width.%]="progress()"></div>
            </div>
            <p class="text-sm text-center text-slate-500 dark:text-slate-400 mt-2">
              Question {{ currentQuestionIndex() + 1 }} of {{ questions().length }}
            </p>
        </div>
        
        <!-- Question -->
        <div class="bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg">
          <p class="text-center text-2xl font-semibold text-slate-900 dark:text-white">{{ question.questionText }}</p>

          <!-- Answer Area -->
          <div class="mt-8">
            @if (question.type === 'mcq') {
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                @for (option of question.options; track option) {
                  <button (click)="selectAnswer(option)" 
                          [disabled]="selectedAnswer() !== null"
                          [class]="getButtonClass(option)"
                          class="p-4 w-full text-lg font-medium rounded-lg border-2 transition-all duration-300 disabled:cursor-not-allowed">
                    {{ option }}
                  </button>
                }
              </div>
            }
            @if (question.type === 'fill-in-the-blank') {
              <div class="flex flex-col items-center">
                <input type="text" 
                       [value]="fillInBlankAnswer()"
                       (input)="fillInBlankAnswer.set($event.target.value)"
                       (keydown.enter)="submitFillInBlank()"
                       [disabled]="selectedAnswer() !== null"
                       [class]="getInputClass()"
                       placeholder="Type your answer here..."
                       class="w-full max-w-sm p-3 text-lg text-center rounded-md shadow-sm dark:bg-slate-700 sm:text-sm transition-colors duration-300">
                <button (click)="submitFillInBlank()"
                        [disabled]="selectedAnswer() !== null || !fillInBlankAnswer()"
                        class="mt-4 px-6 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                  Submit Answer
                </button>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
  @case ('finished') {
    <div class="max-w-2xl mx-auto text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg animate-scale-in">
        <h2 class="text-4xl font-bold text-primary-600 dark:text-primary-400">Quiz Finished!</h2>
        <p class="mt-4 text-2xl font-semibold text-slate-800 dark:text-slate-200">
            You scored {{ score() }} out of {{ questions().length }}
        </p>
        <div class="mt-8 flex justify-center gap-4">
            <button (click)="restartQuiz()" class="px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-colors">Restart Quiz</button>
            <button (click)="backToTopics.emit()" class="px-6 py-3 bg-slate-600 text-white font-semibold rounded-lg shadow-md hover:bg-slate-700 transition-colors">Back to Dashboard</button>
        </div>

        <!-- Results Summary -->
        <div class="mt-10 text-left">
            <h3 class="text-xl font-bold text-slate-900 dark:text-white">Review Your Answers</h3>
            <ul class="mt-4 space-y-3 max-h-96 overflow-y-auto pr-2">
                @for (question of questions(); track question.word.id; let i = $index) {
                    <li class="p-4 rounded-lg" [class.bg-green-50]="userAnswers()[i].correct" [class.dark:bg-green-900/30]="userAnswers()[i].correct" [class.bg-red-50]="!userAnswers()[i].correct" [class.dark:bg-red-900/30]="!userAnswers()[i].correct">
                        <p class="font-semibold text-slate-700 dark:text-slate-300">{{ i + 1 }}. {{ question.questionText }}</p>
                        <p class="mt-1 text-sm">
                            <span class="font-bold">Correct answer:</span>
                            <span class="text-green-600 dark:text-green-400 font-semibold">{{ question.correctAnswer }}</span>
                        </p>
                        @if (!userAnswers()[i].correct) {
                            <p class="text-sm">
                                <span class="font-bold">Your answer:</span>
                                <span class="text-red-600 dark:text-red-400 font-semibold">{{ userAnswers()[i].answer }}</span>
                            </p>
                        }
                    </li>
                }
            </ul>
        </div>
    </div>
  }
}
